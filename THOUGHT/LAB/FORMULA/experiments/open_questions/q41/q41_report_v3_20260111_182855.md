# Q41 Geometric Shape Diagnostics - Test Report v3.1

**Generated:** 2026-01-11T18:28:55.274549+00:00
**Suite Version:** 3.2.0

## Changelog v3.1.0

- **Fix A**: JSON serialization - all booleans are real JSON bools, no "True"/"False" strings
- **Fix B**: Replace Spearman on sorted sequences with L2 distance (non-trivial metrics)
- **Fix C**: Tighten heat_trace_fingerprint negative control (require BOTH distance AND shape)
- **Fix D**: Fix sparse_coding_stability negative control (use log-SV L2 distance)
- **Fix E**: persistent_homology renamed to multiscale_connectivity when ripser unavailable
- **Fix F**: Meta-validation self-tests ensure control sensitivity
- **Fix G**: All NaN/Inf values converted to null in JSON

---

## Configuration

- Seed: 42
- k-neighbors: 10
- Preprocessing: l2
- Distance metric: euclidean
- Corpus size: 64

---

## Summary

**Identity Tests:** 4/4 passed
**Diagnostic Tests:** 8/8 passed

| Test | Type | Result |
|------|------|--------|
| kernel_trace_identity | identity | PASS |
| laplacian_properties | identity | PASS |
| heat_trace_consistency | identity | PASS |
| rotation_invariance | identity | PASS |
| spectral_signature_diagnostic | diagnostic | PASS |
| heat_trace_fingerprint_diagnostic | diagnostic | PASS |
| distance_correlation_diagnostic | diagnostic | PASS |
| covariance_spectrum_diagnostic | diagnostic | PASS |
| sparse_coding_stability_diagnostic | diagnostic | PASS |
| multiscale_connectivity_diagnostic | diagnostic | PASS |
| hecke_operators_diagnostic | diagnostic | PASS |
| automorphic_forms_diagnostic | diagnostic | PASS |

---

## kernel_trace_identity

**Type:** identity
**Result:** PASS

### Notes
trace(K) = sum(eigenvalues(K)) - basic linear algebra identity

### Metrics
```json
{
  "trace_direct": 64.0,
  "trace_eigensum": 64.0,
  "absolute_error": 0.0,
  "relative_error": 0.0
}
```

### Thresholds
```json
{
  "relative_error": 1e-08
}
```

### Controls
```json
{}
```

---

## laplacian_properties

**Type:** identity
**Result:** PASS

### Notes
Normalized Laplacian must be symmetric PSD with eigenvalues in [0,2]

### Metrics
```json
{
  "symmetry_error": 0.0,
  "min_eigenvalue": 9.52317302121147e-17,
  "max_eigenvalue": 1.5358201404679448,
  "n_components": 1,
  "near_zero_eigenvalues": 1,
  "eigenvalue_range": [
    9.52317302121147e-17,
    1.5358201404679448
  ]
}
```

### Thresholds
```json
{
  "symmetry_error": 1e-08,
  "min_eigenvalue": -1e-08,
  "max_eigenvalue": 2.00000001
}
```

### Controls
```json
{}
```

---

## heat_trace_consistency

**Type:** identity
**Result:** PASS

### Notes
trace(exp(-tL)) = sum(exp(-t*lambda_i)) - eigendecomposition identity

### Metrics
```json
{
  "trace_matrix_exp": 25.393374389497595,
  "trace_eigensum": 25.393374389497588,
  "absolute_error": 7.105427357601002e-15,
  "relative_error": 2.798142243163927e-16,
  "t_value": 1.0
}
```

### Thresholds
```json
{
  "relative_error": 1e-06
}
```

### Controls
```json
{}
```

---

## rotation_invariance

**Type:** identity
**Result:** PASS

### Notes
Euclidean distance-based constructions must be rotation-invariant

### Metrics
```json
{
  "distance_matrix_error": 1.5543122344752192e-15,
  "eigenvalue_error": 0.0,
  "heat_trace_error": 0.0
}
```

### Thresholds
```json
{
  "distance_matrix_error": 1e-08,
  "eigenvalue_error": 1e-06,
  "heat_trace_error": 1e-06
}
```

### Controls
```json
{
  "rotation_seed": 1042
}
```

---

## spectral_signature_diagnostic

**Type:** diagnostic
**Result:** PASS

### Notes
Graph Laplacian spectral signatures. L2 distance measures spectrum shape (NOT Spearman on sorted). NOT testing Ramanujan bounds.

### Metrics
```json
{
  "per_model": {
    "MiniLM": {
      "spectral_gap": 0.10923771597746167,
      "max_eigenvalue": 1.5358201404679448,
      "n_components": 1,
      "mean_degree": 7.46875
    },
    "MPNet": {
      "spectral_gap": 0.06629674632239668,
      "max_eigenvalue": 1.6583579000793651,
      "n_components": 1,
      "mean_degree": 7.5
    },
    "Paraphrase": {
      "spectral_gap": 0.06550561201688526,
      "max_eigenvalue": 1.618909068594788,
      "n_components": 1,
      "mean_degree": 6.84375
    },
    "BERT": {
      "spectral_gap": -8.180015971444755e-17,
      "max_eigenvalue": 1.999999999999998,
      "n_components": 17,
      "mean_degree": 3.5625
    }
  },
  "spectral_l2_distances": [
    [
      "MiniLM",
      "MPNet",
      0.011077320650586482
    ],
    [
      "MiniLM",
      "Paraphrase",
      0.014206068753128187
    ],
    [
      "MiniLM",
      "BERT",
      0.07809121247761473
    ],
    [
      "MPNet",
      "Paraphrase",
      0.015002415045194886
    ],
    [
      "MPNet",
      "BERT",
      0.07823957706423651
    ],
    [
      "Paraphrase",
      "BERT",
      0.06740856786544737
    ]
  ],
  "heat_l2_distances": [
    [
      "MiniLM",
      "MPNet",
      0.0006693524858724598
    ],
    [
      "MiniLM",
      "Paraphrase",
      0.003406617645149349
    ],
    [
      "MiniLM",
      "BERT",
      0.02742638664326859
    ],
    [
      "MPNet",
      "Paraphrase",
      0.002875246551357135
    ],
    [
      "MPNet",
      "BERT",
      0.02684659637733792
    ],
    [
      "Paraphrase",
      "BERT",
      0.024033225855265215
    ]
  ],
  "mean_spectral_distance": 0.04400419364270136,
  "mean_heat_distance": 0.014209570926375112
}
```

### Thresholds
```json
{
  "positive_control_error": 1e-06,
  "negative_l2_distance_min": 0.05
}
```

### Controls
```json
{
  "positive_rotated_error": 0.0,
  "positive_control_pass": true,
  "negative_noise_components": 6,
  "negative_spectral_gap_orig": 0.10923771597746167,
  "negative_spectral_gap_noise": 7.700330190437261e-16,
  "negative_gap_ratio": 0.9999999990845583,
  "negative_noise_l2_distance": 0.06758306524626705,
  "negative_control_pass": true
}
```

---

## heat_trace_fingerprint_diagnostic

**Type:** diagnostic
**Result:** PASS

### Notes
Heat trace curves encode multi-scale geometry. Negative control requires BOTH distance threshold AND ratio vs positive control (Fix C).

### Metrics
```json
{
  "heat_curve_distances": [
    [
      "MiniLM",
      "MPNet",
      0.001335409491137795
    ],
    [
      "MiniLM",
      "Paraphrase",
      0.006616822039827644
    ],
    [
      "MiniLM",
      "BERT",
      0.053200047139933336
    ],
    [
      "MPNet",
      "Paraphrase",
      0.005543143546339252
    ],
    [
      "MPNet",
      "BERT",
      0.05202759817381133
    ],
    [
      "Paraphrase",
      "BERT",
      0.046610460869503864
    ]
  ],
  "mean_distance": 0.0275555802100922,
  "t_grid": [
    0.01,
    0.1,
    0.5,
    1.0,
    2.0,
    5.0
  ]
}
```

### Thresholds
```json
{
  "diagnostic_threshold": 0.1,
  "neg_dist_min": 0.020000000000000004,
  "neg_pos_ratio_min": 5.0
}
```

### Controls
```json
{
  "positive_rotated_distance": 0.0,
  "positive_control_pass": true,
  "negative_noise_distance": 0.023587745604447364,
  "negative_shape_diff": 0.39258866289643235,
  "negative_dist_exceeds_min": true,
  "negative_dist_exceeds_ratio": true,
  "negative_control_pass": true
}
```

---

## distance_correlation_diagnostic

**Type:** diagnostic
**Result:** PASS

### Notes
Distance matrix correlation measures agreement on relative distances. NOT claimed to test Langlands duality.

### Metrics
```json
{
  "pairwise_correlations": [
    [
      "MiniLM",
      "MPNet",
      0.6073899782253773
    ],
    [
      "MiniLM",
      "Paraphrase",
      0.3480961338254987
    ],
    [
      "MiniLM",
      "BERT",
      0.18817877563339522
    ],
    [
      "MPNet",
      "Paraphrase",
      0.30017881945329283
    ],
    [
      "MPNet",
      "BERT",
      0.16815862580332328
    ],
    [
      "Paraphrase",
      "BERT",
      0.07237196168617795
    ]
  ],
  "mean_correlation": 0.28072904910451085
}
```

### Thresholds
```json
{
  "positive_threshold": 0.999,
  "negative_threshold": 0.5
}
```

### Controls
```json
{
  "positive_rotated_correlation": 1.0,
  "positive_control_pass": true,
  "negative_shuffled_correlation": 0.023374992113297164,
  "negative_control_pass": true
}
```

---

## covariance_spectrum_diagnostic

**Type:** diagnostic
**Result:** PASS

### Notes
Covariance eigenspectrum comparison. L2 distance measures shape (NOT Spearman on sorted). Alpha CV measures decay consistency. NOT claimed as Ramanujan bound.

### Metrics
```json
{
  "per_model": {
    "MiniLM": {
      "participation_ratio": 33.81423725725791,
      "decay_exponent_alpha": 0.5464959565267073,
      "decay_prefactor_C": 0.9876402668329037,
      "top_5_eigenvalues": [
        0.9999999983991184,
        0.684371973136147,
        0.5009282464962311,
        0.4163385994757173,
        0.3837448018848588
      ]
    },
    "MPNet": {
      "participation_ratio": 34.556084397547025,
      "decay_exponent_alpha": 0.555758152421964,
      "decay_prefactor_C": 1.2626991846951565,
      "top_5_eigenvalues": [
        0.9999999981933021,
        0.9580781011623044,
        0.6736919608499428,
        0.5993383196267391,
        0.5336697293234858
      ]
    },
    "Paraphrase": {
      "participation_ratio": 31.842866712959427,
      "decay_exponent_alpha": 0.5997881940408291,
      "decay_prefactor_C": 1.465863117362368,
      "top_5_eigenvalues": [
        0.9999999982721646,
        0.9283948254374179,
        0.7227181690885415,
        0.6647758145792789,
        0.5863002172534412
      ]
    },
    "BERT": {
      "participation_ratio": 17.48249333159425,
      "decay_exponent_alpha": 0.91237447534555,
      "decay_prefactor_C": 1.2462983868460957,
      "top_5_eigenvalues": [
        0.9999999891679903,
        0.6183622552681503,
        0.45687999093383247,
        0.37011038872858987,
        0.290378451373423
      ]
    }
  },
  "spectral_l2_distances": [
    [
      "MiniLM",
      "MPNet",
      0.12028139823478919
    ],
    [
      "MiniLM",
      "Paraphrase",
      0.15244563080509735
    ],
    [
      "MiniLM",
      "BERT",
      0.17749414183773152
    ],
    [
      "MPNet",
      "Paraphrase",
      0.04891502136765619
    ],
    [
      "MPNet",
      "BERT",
      0.26786674286082823
    ],
    [
      "Paraphrase",
      "BERT",
      0.2962037095425525
    ]
  ],
  "mean_spectral_l2_distance": 0.1772011074414425,
  "alpha_mean": 0.6536041945837625,
  "alpha_std": 0.1507516523511323,
  "alpha_cv": 0.23064670266394394
}
```

### Thresholds
```json
{
  "positive_control_error": 1e-06,
  "alpha_cv_threshold": 0.3
}
```

### Controls
```json
{
  "positive_rotated_error": 1.536818561298503e-09,
  "positive_control_pass": true,
  "negative_pr_orig": 33.81423725725791,
  "negative_pr_gaussian": 62.99999960309996,
  "negative_pr_diff_ratio": 0.8631205288976698,
  "negative_alpha_orig": 0.5464959565267073,
  "negative_alpha_gaussian": 1.5463162496792355e-15,
  "negative_alpha_diff_ratio": 0.9999999998170132,
  "negative_control_pass": true
}
```

---

## sparse_coding_stability_diagnostic

**Type:** diagnostic
**Result:** PASS

### Notes
Sparse coding stability test. Negative control uses L2 distance on log-singular values (NOT Spearman - Fix D). NOT testing UFD or semantic primes.

### Metrics
```json
{
  "n_components": 30,
  "mean_stability": 0.602693247795105,
  "std_stability": 0.016864843016241218,
  "mean_reconstruction_error": 0.47177064390248213,
  "n_stability_trials": 10
}
```

### Thresholds
```json
{
  "stability_threshold": 0.5,
  "reconstruction_threshold": 0.5,
  "alignment_threshold": 0.7,
  "sv_log_l2_threshold": 0.1
}
```

### Controls
```json
{
  "positive_sv_rel_error": 2.5016919375578008e-08,
  "positive_control_pass": true,
  "negative_subspace_alignment": 0.20285120865477424,
  "negative_sv_log_l2_distance": 0.5576523904582166,
  "negative_alignment_poor": true,
  "negative_sv_shape_different": true,
  "negative_control_pass": true
}
```

---

## multiscale_connectivity_diagnostic

**Type:** diagnostic
**Result:** PASS

### Notes
Multiscale connectivity analysis (NOT persistent homology). Measures how graph components merge at different epsilon-ball radii. Install ripser+persim for proper H0/H1 persistent homology.

### Metrics
```json
{
  "per_model": {
    "MiniLM": {
      "scales": [
        1.0899760574601516,
        1.1360687335490958,
        1.1833030764842243,
        1.2245427259941566,
        1.25815608520118
      ],
      "components": [
        1,
        1,
        1,
        1,
        1
      ]
    },
    "MPNet": {
      "scales": [
        1.1523745008690935,
        1.2057705889615098,
        1.245132853553058,
        1.2778406838502294,
        1.3038309214003887
      ],
      "components": [
        1,
        1,
        1,
        1,
        1
      ]
    },
    "Paraphrase": {
      "scales": [
        1.1454974784176029,
        1.2237184245479957,
        1.2758061587942573,
        1.3208985906660886,
        1.3525826623813417
      ],
      "components": [
        3,
        1,
        1,
        1,
        1
      ]
    },
    "BERT": {
      "scales": [
        0.23635961625123214,
        0.2762953558824421,
        0.3299723982401518,
        0.3853966533233336,
        0.4249387843306757
      ],
      "components": [
        27,
        16,
        2,
        1,
        1
      ]
    }
  },
  "component_l2_distances": [
    [
      "MiniLM",
      "MPNet",
      0.0
    ],
    [
      "MiniLM",
      "Paraphrase",
      0.34237082448518896
    ],
    [
      "MiniLM",
      "BERT",
      0.8907675424489568
    ],
    [
      "MPNet",
      "Paraphrase",
      0.34237082448518896
    ],
    [
      "MPNet",
      "BERT",
      0.8907675424489568
    ],
    [
      "Paraphrase",
      "BERT",
      0.8071550941777738
    ]
  ],
  "mean_l2_distance": 0.5455719713410109,
  "method": "epsilon_connectivity"
}
```

### Thresholds
```json
{
  "positive_control_threshold": 1e-06,
  "negative_control_threshold": 0.1
}
```

### Controls
```json
{
  "positive_rotated_l2_distance": 0.0,
  "positive_control_pass": true,
  "negative_noise_l2_distance": 0.9692307692301023,
  "negative_control_pass": true,
  "note": "Using multiscale connectivity (ripser unavailable). Install ripser+persim for proper persistent homology."
}
```

---

## hecke_operators_diagnostic

**Type:** diagnostic
**Result:** PASS

### Notes
TIER 3: Hecke-like averaging operators. Tests commutativity T_k T_l = T_l T_k and eigenvalue structure. Low commutativity error suggests algebraic structure exists.

### Metrics
```json
{
  "commutativity_errors": [
    [
      3,
      5,
      0.027756067905111273
    ],
    [
      3,
      7,
      0.027114385652172817
    ],
    [
      3,
      10,
      0.024836706286557778
    ],
    [
      5,
      7,
      0.015808867151426882
    ],
    [
      5,
      10,
      0.016967339950596263
    ],
    [
      7,
      10,
      0.011447215540123262
    ]
  ],
  "mean_commutativity_error": 0.02065509708099805,
  "symmetry_errors": [
    [
      3,
      0.36799003608902636
    ],
    [
      5,
      0.38729833460991636
    ],
    [
      7,
      0.3779644729967272
    ],
    [
      10,
      0.35575623675488016
    ]
  ],
  "mean_symmetry_error": 0.3722522701126375,
  "eigenvalue_stats": {
    "3": {
      "spectral_gap": 0.05438586571554538,
      "max_eigenvalue": 1.1051517692827257,
      "min_eigenvalue": -0.8130613434096485,
      "eigenvalue_range": 1.9182131126923743
    },
    "5": {
      "spectral_gap": 0.053339146982837926,
      "max_eigenvalue": 1.0882901161077303,
      "min_eigenvalue": -0.6396845692931212,
      "eigenvalue_range": 1.7279746854008515
    },
    "7": {
      "spectral_gap": 0.14772209514502754,
      "max_eigenvalue": 1.0883257034383629,
      "min_eigenvalue": -0.4817468125317692,
      "eigenvalue_range": 1.570072515970132
    },
    "10": {
      "spectral_gap": 0.2039231321755054,
      "max_eigenvalue": 1.064565104270599,
      "min_eigenvalue": -0.40663596067431895,
      "eigenvalue_range": 1.471201064944918
    }
  },
  "cross_model_spectral_distances": [
    [
      "MiniLM",
      "MPNet",
      0.03320364934019014
    ],
    [
      "MiniLM",
      "Paraphrase",
      0.04420577050437103
    ],
    [
      "MiniLM",
      "BERT",
      0.1045975145331197
    ]
  ],
  "mean_cross_model_distance": 0.060668978125893634
}
```

### Thresholds
```json
{
  "commutativity_threshold": 0.3,
  "positive_control_threshold": 1e-06,
  "negative_control_threshold": 0.05
}
```

### Controls
```json
{
  "positive_rotated_error": 0.0,
  "positive_control_pass": true,
  "negative_random_distance": 0.16627380062380823,
  "negative_control_pass": true
}
```

---

## automorphic_forms_diagnostic

**Type:** diagnostic
**Result:** PASS

### Notes
TIER 4: Automorphic-like eigenfunctions of graph Laplacian. Tests orthogonality, completeness, and transformation properties. These eigenfunctions are analogs of automorphic forms.

### Metrics
```json
{
  "orthogonality_error": 2.2510618613920613e-16,
  "reconstruction_error": 0.2176794629335192,
  "n_eigenfunctions_tested": 20,
  "eigenvalue_gap_stats": {
    "mean_gap": 0.04488112762804184,
    "gap_variance": 0.0007911322436306125,
    "gap_cv": 0.6267015685106851
  },
  "participation_ratio_stats": {
    "mean": 24.178393169728583,
    "std": 10.229655994551216,
    "values": [
      59.070320230180386,
      43.277135385797976,
      19.963904268292698,
      15.068964962638981,
      32.72916972779468,
      21.029262930697275,
      27.632765709907762,
      16.6789682989519,
      17.621560141368818,
      27.496561256577635
    ]
  },
  "cross_model_similarities": [
    [
      "MiniLM",
      "MPNet",
      0.022808432029580952
    ],
    [
      "MiniLM",
      "Paraphrase",
      0.03495990817297722
    ],
    [
      "MiniLM",
      "BERT",
      0.1684899230667111
    ]
  ],
  "mean_cross_model_distance": 0.07541942108975642
}
```

### Thresholds
```json
{
  "orthogonality_threshold": 0.01,
  "reconstruction_threshold": 0.9,
  "positive_control_threshold": 1e-06,
  "negative_control_threshold": 0.05
}
```

### Controls
```json
{
  "positive_rotated_error": 9.992007221626409e-16,
  "positive_control_pass": true,
  "negative_noise_distance": 0.11630261199764236,
  "negative_control_pass": true
}
```

---

## What v3.2.0 Tests

This version adds **TIER 3 and TIER 4** Langlands-related tests:

1. **TIER 3: Hecke Operators** - Constructs averaging operators T_k on k-neighborhoods, tests commutativity T_k T_l = T_l T_k
2. **TIER 4: Automorphic Forms** - Tests eigenfunctions of Laplacian as analogs of automorphic forms (orthogonality, completeness)

## What This Does NOT Prove

This test suite provides geometric and algebraic diagnostics. It does **NOT**:

1. **Prove full Langlands correspondence** - Tests necessary but not sufficient conditions
2. **Construct L-functions** - No Euler products or functional equations (TIER 2 not implemented)
3. **Verify Arthur-Selberg trace formula** - No spectral/geometric side equality (TIER 5 not implemented)
4. **Establish UFD structure** - No unique factorization into semantic primes (TIER 6 not implemented)
5. **Construct TQFT** - No categorical composition or cobordism maps

The TIER 3/4 tests show **algebraic structure exists** but do not prove it satisfies full Langlands axioms.
