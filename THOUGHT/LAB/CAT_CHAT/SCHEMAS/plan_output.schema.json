{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Catalytic Chat Plan Output",
  "type": "object",
  "additionalProperties": false,
  "required": ["run_id", "request_id", "planner_version", "steps", "plan_hash"],
  "properties": {
    "run_id": {
      "type": "string",
      "description": "Run context for this plan"
    },
    "request_id": {
      "type": "string",
      "description": "Request ID that generated this plan"
    },
    "planner_version": {
      "type": "string",
      "description": "Version of the planner that generated this plan"
    },
    "steps": {
      "type": "array",
      "description": "Ordered list of steps in the plan",
      "items": {
        "$ref": "#/definitions/PlanStep"
      }
    },
    "plan_hash": {
      "type": "string",
      "description": "SHA256 hash of canonical plan representation"
    }
  },
  "definitions": {
    "PlanStep": {
      "type": "object",
      "additionalProperties": false,
      "required": ["step_id", "ordinal", "op"],
      "properties": {
        "step_id": {
          "type": "string",
          "description": "Unique step identifier"
        },
        "ordinal": {
          "type": "integer",
          "description": "Step order within the plan"
        },
        "op": {
          "type": "string",
          "enum": ["READ_SECTION", "READ_SYMBOL", "WRITE_FILE", "PATCH_FILE", "RUN_TEST", "NOTE"],
          "description": "Type of operation to perform"
        },
        "refs": {
          "type": "object",
          "description": "References to external resources"
        },
        "constraints": {
          "type": "object",
          "description": "Constraints on this step"
        },
        "expected_outputs": {
          "type": "object",
          "description": "Expected outputs after this step"
        }
      }
    }
  }
}
