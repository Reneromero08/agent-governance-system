#!/bin/sh
# Pre-commit hook for canon governance check
# Install with: cp SKILLS/canon-governance-check/scripts/pre-commit .git/hooks/pre-commit

echo "üîç Running canon governance check..."

# Run preflight freshness check (allow dirty tracked due to staging).
echo "üîç Running preflight..."
python3 TOOLS/ags.py preflight --allow-dirty-tracked
PREFLIGHT_EXIT=$?
if [ $PREFLIGHT_EXIT -ne 0 ]; then
    echo ""
    echo "‚ùå Preflight failed!"
    echo "   Fix preflight issues before committing."
    exit 1
fi

# Run the governance check
node TOOLS/check-canon-governance.js

# Capture exit code
EXIT_CODE=$?

if [ $EXIT_CODE -ne 0 ]; then
    echo ""
    echo "‚ùå Pre-commit check failed!"
    echo "   Fix governance issues before committing."
    echo "   Run 'node TOOLS/check-canon-governance.js --verbose' for details."
    exit 1
fi

echo "‚úÖ Governance check passed"
exit 0
