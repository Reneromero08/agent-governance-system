# Cortex

The cortex is a shadow index of the repository. It allows agents and skills to query metadata about files, pages and tokens without scanning the filesystem or loading full documents into context.

The cortex consists of:

- `cortex.schema.json` - A JSON schema describing the structure of the cortex index.
- `CORTEX/_generated/cortex.db` - The current instance of the index (SQLite), generated by `cortex.build.py`.
- `CORTEX/_generated/cortex.json` - A generated JSON snapshot used for tooling and CI checks.
- `CORTEX/_generated/SECTION_INDEX.json` - A generated section-level index (1-based inclusive line ranges + hashes) for heading-based markdown sections.
- `CORTEX/_generated/SUMMARY_INDEX.json` - A generated index of deterministic, advisory section summaries.
- `CORTEX/_generated/summaries/` - Per-section summary files keyed by section_id.
- `cortex.json` - A legacy snapshot kept for backward compatibility.
- `cortex.build.py` - A script that scans the repository and produces `CORTEX/_generated/cortex.db` and `CORTEX/_generated/cortex.json`.
- `query.py` - A Python module providing functions to query the cortex.

Agents must use `query.py` to discover files instead of using OS calls directly. This ensures that navigation is consistent, efficient and governed by the canon.

To print a section by id from the generated index:
- `python TOOLS/cortex.py read <section_id>`
- `python TOOLS/cortex.py resolve <section_id>`
- `python TOOLS/cortex.py search "<query>"`
- `python TOOLS/cortex.py summary <section_id>` (System-1 advisory; never authoritative)

Citation format: `section_id:start_line-end_line`
Example: `CANON/CONTRACT.md::canon-contract::01:1-12`

Notes:
- Line numbers are 1-based inclusive.
- Hashes correspond to the section slice with newline normalization to `\n`.
- Summary files begin with `source: <section_id>:<start_line>-<end_line>#<hash8>`.

## Generated files

The `_generated/` directory is excluded from version control (`.gitignore`). This is intentional:

- **Always rebuildable:** Run `python CORTEX/cortex.build.py` to regenerate the index at any time.
- **CI validated:** The build script runs in CI to ensure the index can always be generated from the current repo state.
- **Deterministic:** Given the same repo content and `CORTEX_BUILD_TIMESTAMP` env var, the output is identical.

The repo-tracked `cortex.json` is a legacy fallback and is not used by the SQLite query path.
