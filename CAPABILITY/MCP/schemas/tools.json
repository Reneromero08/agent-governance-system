{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "AGS MCP Tools Schema",
    "description": "JSON Schema definitions for AGS MCP server tools",
    "definitions": {
        "context_search": {
            "name": "context_search",
            "description": "Search AGS context records (ADRs, preferences, rejected, open)",
            "inputSchema": {
                "type": "object",
                "properties": {
                    "query": {
                        "type": "string",
                        "description": "Text search in titles and content"
                    },
                    "tags": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "description": "Filter by tags"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "accepted",
                            "proposed",
                            "deprecated",
                            "rejected",
                            "active",
                            "experimental"
                        ],
                        "description": "Filter by status"
                    },
                    "type": {
                        "type": "string",
                        "enum": [
                            "decisions",
                            "preferences",
                            "rejected",
                            "open"
                        ],
                        "description": "Filter by record type"
                    }
                }
            }
        },
        "context_review": {
            "name": "context_review",
            "description": "Check for overdue or upcoming ADR reviews",
            "inputSchema": {
                "type": "object",
                "properties": {
                    "days": {
                        "type": "integer",
                        "default": 30,
                        "description": "Flag reviews due within N days"
                    }
                }
            }
        },
        "skill_run": {
            "name": "skill_run",
            "description": "Execute an AGS skill with the given input",
            "inputSchema": {
                "type": "object",
                "properties": {
                    "skill": {
                        "type": "string",
                        "description": "Name of the skill to run (e.g., 'pack-validate')"
                    },
                    "input": {
                        "type": "object",
                        "description": "Input payload for the skill"
                    }
                },
                "required": [
                    "skill",
                    "input"
                ]
            }
        },
        "canon_read": {
            "name": "canon_read",
            "description": "Read a canon file (CONTRACT, INVARIANTS, VERSIONING, etc.)",
            "inputSchema": {
                "type": "object",
                "properties": {
                    "file": {
                        "type": "string",
                        "enum": [
                            "CONTRACT",
                            "INVARIANTS",
                            "VERSIONING",
                            "GENESIS",
                            "ARBITRATION",
                            "DEPRECATION",
                            "MIGRATION",
                            "GLOSSARY",
                            "CHANGELOG"
                        ],
                        "description": "Name of the canon file to read"
                    }
                },
                "required": [
                    "file"
                ]
            }
        },
        "codebook_lookup": {
            "name": "codebook_lookup",
            "description": "Resolve symbolic identifiers with optional stacked filtering. L1 (symbol), L1+L2 (FTS), L1+L3 (semantic). Reference: THOUGHT/LAB/FORMULA/CODIFIER.md",
            "inputSchema": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Symbol to resolve. Domains: 法, 真, 契, 恆, 驗. Operations: 證, 變, 冊, 錄. ASCII: C3, I5, C*. Compounds: 法.驗"
                    },
                    "expand": {
                        "type": "boolean",
                        "default": false,
                        "description": "L1: Return full content (56,370x compression)"
                    },
                    "query": {
                        "type": "string",
                        "description": "L1+L2: FTS query within symbol domain (~4,200 tokens)"
                    },
                    "semantic": {
                        "type": "string",
                        "description": "L1+L3: Semantic query within symbol domain (~2,000 tokens)"
                    },
                    "limit": {
                        "type": "integer",
                        "default": 10,
                        "description": "Max results for filtered queries"
                    },
                    "list": {
                        "type": "boolean",
                        "default": false,
                        "description": "List all symbols"
                    }
                }
            }
        },
        "session_info": {
            "name": "session_info",
            "description": "Get information about the current MCP session including session_id for ADR-021 compliance",
            "inputSchema": {
                "type": "object",
                "properties": {
                    "include_audit_log": {
                        "type": "boolean",
                        "default": false,
                        "description": "Include recent audit log entries for this session"
                    },
                    "limit": {
                        "type": "integer",
                        "default": 10,
                        "description": "Maximum audit log entries to include"
                    }
                }
            }
        },
        "skill_discovery": {
            "name": "skill_discovery",
            "description": "Find skills by semantic intent query. Searches 24 indexed skills and returns the most relevant based on description, purpose, and triggers.",
            "inputSchema": {
                "type": "object",
                "properties": {
                    "query": {
                        "type": "string",
                        "description": "Natural language intent query (e.g., 'verify canon changes', 'manage git commits')"
                    },
                    "top_k": {
                        "type": "integer",
                        "default": 5,
                        "description": "Maximum number of skills to return"
                    },
                    "threshold": {
                        "type": "number",
                        "description": "Minimum similarity score (0.0-1.0). Optional - omit to return all results."
                    }
                },
                "required": [
                    "query"
                ]
            }
        },
        "find_related": {
            "name": "find_related",
            "description": "Find related artifacts by embedding similarity across all indexed types (canon, ADRs, skills). Searches the cross-reference graph to discover semantically related content.",
            "inputSchema": {
                "type": "object",
                "properties": {
                    "artifact_id": {
                        "type": "string",
                        "description": "Artifact identifier in format 'type:path' (e.g., 'canon:LAW/CANON/GOVERNANCE/IMMUTABILITY.md', 'adr:THOUGHT/LEDGER/ADR/2024/001.md', 'skill:CAPABILITY/SKILLS/governance/canon-governance-check/SKILL.md')"
                    },
                    "top_k": {
                        "type": "integer",
                        "default": 5,
                        "description": "Maximum number of related artifacts to return"
                    },
                    "threshold": {
                        "type": "number",
                        "description": "Minimum similarity score (0.0-1.0). Optional - omit to return all results."
                    }
                },
                "required": [
                    "artifact_id"
                ]
            }
        },
        "cassette_network_query": {
            "name": "cassette_network_query",
            "description": "Query the cassette network for distributed semantic search",
            "inputSchema": {
                "type": "object",
                "properties": {
                    "query": {
                        "type": "string",
                        "description": "Search query"
                    },
                    "limit": {
                        "type": "integer",
                        "default": 10,
                        "description": "Maximum results per cassette"
                    },
                    "capability": {
                        "type": "string",
                        "description": "Filter by cassette capability (e.g., 'vectors', 'fts')"
                    }
                },
                "required": [
                    "query"
                ]
            }
        },
        "semantic_stats": {
            "name": "semantic_stats",
            "description": "Get statistics about semantic embeddings and cassette network",
            "inputSchema": {
                "type": "object",
                "properties": {}
            }
        },
        "memory": {
            "name": "memory",
            "description": "Unified memory tool for persistent AI memory operations (save, query, recall, neighbors, stats)",
            "inputSchema": {
                "type": "object",
                "properties": {
                    "operation": {
                        "type": "string",
                        "enum": ["save", "query", "recall", "neighbors", "stats"],
                        "description": "Operation to perform: save (store memory), query (semantic search), recall (get by hash), neighbors (find similar), stats (get statistics)"
                    },
                    "text": {
                        "type": "string",
                        "description": "Memory content to save (required for 'save' operation)"
                    },
                    "query": {
                        "type": "string",
                        "description": "Search query for semantic similarity (required for 'query' operation)"
                    },
                    "hash": {
                        "type": "string",
                        "description": "Content-addressed hash of memory (required for 'recall' and 'neighbors' operations)"
                    },
                    "metadata": {
                        "type": "object",
                        "description": "Optional metadata dictionary (for 'save' operation)"
                    },
                    "agent_id": {
                        "type": "string",
                        "description": "Agent identifier (optional, default: default)"
                    },
                    "limit": {
                        "type": "integer",
                        "default": 10,
                        "description": "Maximum results to return (for 'query' and 'neighbors' operations)"
                    }
                },
                "required": ["operation"]
            }
        }
    },
    "tools": [
        {
            "$ref": "#/definitions/context_search"
        },
        {
            "$ref": "#/definitions/context_review"
        },
        {
            "$ref": "#/definitions/skill_discovery"
        },
        {
            "$ref": "#/definitions/find_related"
        },
        {
            "$ref": "#/definitions/cassette_network_query"
        },
        {
            "$ref": "#/definitions/semantic_stats"
        },
        {
            "$ref": "#/definitions/memory"
        },
        {
            "$ref": "#/definitions/skill_run"
        },
        {
            "$ref": "#/definitions/canon_read"
        },
        {
            "$ref": "#/definitions/codebook_lookup"
        },
        {
            "$ref": "#/definitions/session_info"
        }
    ]
}