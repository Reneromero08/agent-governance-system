============================= test session starts =============================
platform win32 -- Python 3.11.6, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\rene_\AppData\Local\Programs\Python\Python311\python.exe
cachedir: .pytest_cache
rootdir: D:\CCC 2.0\AI\agent-governance-system
configfile: pytest.ini
plugins: anyio-4.12.0
collecting ... collected 1 item

CAPABILITY/TESTBENCH/test_memoization.py::test_memoization_miss_then_hit_then_invalidate FAILED [100%]

================================== FAILURES ===================================
_______________ test_memoization_miss_then_hit_then_invalidate ________________

tmp_path = WindowsPath('C:/Users/rene_/AppData/Local/Temp/pytest-of-Reneshizzle/pytest-202/test_memoization_miss_then_hit0')

    def test_memoization_miss_then_hit_then_invalidate(tmp_path: Path) -> None:
        # Import runtime from CAPABILITY.TOOLS (repo-root module).
        import sys
        sys.path.insert(0, str(REPO_ROOT / "CAPABILITY" / "TOOLS" / "catalytic"))
        # sys.path cleanup
    
        from catalytic_runtime import CatalyticRuntime, PROJECT_ROOT  # type: ignore
        from CAPABILITY.PRIMITIVES.memo_cache import compute_job_cache_key  # type: ignore
    
        assert PROJECT_ROOT == REPO_ROOT
    
        run_id = "memoization-test-run"
        run_dir = REPO_ROOT / "LAW" / "CONTRACTS" / "_runs" / run_id
        cache_root = REPO_ROOT / "LAW" / "CONTRACTS" / "_runs" / "_cache" / "jobs"
    
        catalytic_domain = "LAW/CONTRACTS/_runs/_tmp/memoization-domain"
        durable_output = "NAVIGATION/CORTEX/_generated/memoization_output.txt"
        side_effect = "LAW/CONTRACTS/_runs/_tmp/memoization_side_effect.txt"
    
        # Clean any prior state.
        _rm(run_dir)
        _rm(cache_root)
        _rm(REPO_ROOT / durable_output)
        _rm(REPO_ROOT / side_effect)
    
        try:
            runtime1 = CatalyticRuntime(
                run_id=run_id,
                catalytic_domains=[catalytic_domain],
                durable_outputs=[durable_output],
                intent="memoization test",
                strict=True,
                memoize=True,
                validator_semver="0.1.0",
                validator_build_id="memo-test",
            )
    
            cmd_a = [
                sys.executable,
                "-c",
                (
                    "from pathlib import Path;"
                    f"Path('{durable_output}').write_text('A', encoding='utf-8');"
                    f"Path('{side_effect}').write_text('EXEC_A', encoding='utf-8')"
                ),
            ]
            assert runtime1.run(cmd_a) == 0
    
            proof_bytes_1 = (run_dir / "PROOF.json").read_bytes()
            roots_bytes_1 = (run_dir / "DOMAIN_ROOTS.json").read_bytes()
    
            input_domain_roots = runtime1._compute_input_domain_roots()
            cache_key = compute_job_cache_key(
                jobspec=runtime1.build_jobspec(),
                input_domain_roots=input_domain_roots,
                validator_semver=runtime1.validator_semver,
                validator_build_id=runtime1.validator_build_id,
                strict=runtime1.strict,
            )
    
            cache_dir = cache_root / cache_key
>           assert cache_dir.exists()
E           AssertionError: assert False
E            +  where False = exists()
E            +    where exists = WindowsPath('D:/CCC 2.0/AI/agent-governance-system/LAW/CONTRACTS/_runs/_cache/jobs/5f91748369a8a8d1706360669bb894437b97522e82d91139419026bb0e8f9e88').exists

CAPABILITY\TESTBENCH\test_memoization.py:84: AssertionError
---------------------------- Captured stdout call -----------------------------
[catalytic] Starting catalytic run: memoization-test-run
[catalytic] Phase 0: Preflight validation...
[catalytic] Preflight passed: JobSpec is valid
[catalytic] Phase 1: Capturing pre-snapshots...
[catalytic] Snapshots pre: LAW\CONTRACTS\_runs\_tmp\memoization-domain (0 files)
[catalytic] Memoization HIT: 72e3d854fcfcfa5a3e27abde88c06fba7f55441c0c6a66ad6f039a14b9887c5b
[catalytic] Snapshots post: LAW\CONTRACTS\_runs\_tmp\memoization-domain (0 files)
[catalytic] Canonical artifact set written to D:\CCC 2.0\AI\agent-governance-system\LAW\CONTRACTS\_runs\memoization-test-run
[catalytic] PROOF.json: verified=True, condition=RESTORED_IDENTICAL
[catalytic] Canonical artifact set written to D:\CCC 2.0\AI\agent-governance-system\LAW\CONTRACTS\_runs\memoization-test-run
[catalytic] PROOF.json: verified=True, condition=RESTORED_IDENTICAL
============================== warnings summary ===============================
CAPABILITY/TESTBENCH/test_memoization.py::test_memoization_miss_then_hit_then_invalidate
CAPABILITY/TESTBENCH/test_memoization.py::test_memoization_miss_then_hit_then_invalidate
  D:\CCC 2.0\AI\agent-governance-system\CAPABILITY\PRIMITIVES\ledger.py:9: DeprecationWarning: jsonschema.RefResolver is deprecated as of v4.18.0, in favor of the https://github.com/python-jsonschema/referencing library, which provides more compliant referencing behavior as well as more flexible APIs for customization. A future release will remove RefResolver. Please file a feature request (on referencing) if you are missing an API for the kind of customization you need.
    from jsonschema import Draft7Validator, RefResolver

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED CAPABILITY/TESTBENCH/test_memoization.py::test_memoization_miss_then_hit_then_invalidate - AssertionError: assert False
 +  where False = exists()
 +    where exists = WindowsPath('D:/CCC 2.0/AI/agent-governance-system/LAW/CONTRACTS/_runs/_cache/jobs/5f91748369a8a8d1706360669bb894437b97522e82d91139419026bb0e8f9e88').exists
======================== 1 failed, 2 warnings in 0.20s ========================
