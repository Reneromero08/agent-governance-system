============================= test session starts =============================
platform win32 -- Python 3.11.6, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\rene_\AppData\Local\Programs\Python\Python311\python.exe
cachedir: .pytest_cache
rootdir: D:\CCC 2.0\AI\agent-governance-system
configfile: pytest.ini
plugins: anyio-4.12.0
collecting ... collected 4 items

CAPABILITY/TESTBENCH/test_pipeline_chain.py::test_pipeline_chain_valid FAILED [ 25%]
CAPABILITY/TESTBENCH/test_pipeline_chain.py::test_pipeline_chain_tamper FAILED [ 50%]
CAPABILITY/TESTBENCH/test_pipeline_chain.py::test_pipeline_chain_reorder FAILED [ 75%]
CAPABILITY/TESTBENCH/test_pipeline_chain.py::test_pipeline_chain_determinism FAILED [100%]

================================== FAILURES ===================================
__________________________ test_pipeline_chain_valid __________________________

tmp_path = WindowsPath('C:/Users/rene_/AppData/Local/Temp/pytest-of-Reneshizzle/pytest-222/test_pipeline_chain_valid0')

    def test_pipeline_chain_valid(tmp_path: Path) -> None:
        pipeline_id = "pipeline-chain-valid"
        spec_path, pipeline_dir = _setup_pipeline(Path("pipeline_chain_valid"), pipeline_id=pipeline_id)
        rt = PipelineRuntime(project_root=REPO_ROOT)
        try:
>           rt.run(pipeline_id=pipeline_id, spec_path=spec_path)

CAPABILITY\TESTBENCH\test_pipeline_chain.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
CAPABILITY\PIPELINES\pipeline_runtime.py:204: in run
    self._execute_step(spec=spec, step=step, run_id=run_id)
CAPABILITY\PIPELINES\pipeline_runtime.py:404: in _execute_step
    jobspec = self._load_jobspec(step.jobspec_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <CAPABILITY.PIPELINES.pipeline_runtime.PipelineRuntime object at 0x000001BBDD1A0F10>
jobspec_path = 'pipeline_chain_valid/jobspec_step1.json'

    def _load_jobspec(self, jobspec_path: str) -> Dict[str, Any]:
        rel = jobspec_path.replace("\\", "/")
        if Path(rel).is_absolute():
            raise ValueError("jobspec_path must be repo-relative")
        abs_path = self.project_root / rel
        obj = json.loads(abs_path.read_text(encoding="utf-8"))
        if not isinstance(obj, dict):
            raise ValueError("jobspec must be an object")
        preflight = PreflightValidator(self.jobspec_schema_path)
        valid, errors = preflight.validate(obj, self.project_root)
        if not valid:
            first = errors[0] if errors else {"code": "JOBSPEC_INVALID", "message": "invalid"}
>           raise ValueError(f"jobspec invalid: {first.get('code')}: {first.get('message')}")
E           ValueError: jobspec invalid: PATH_NOT_ALLOWED: Path pipeline_chain_valid/domain in catalytic_domains not under allowed roots: ['LAW/CONTRACTS/_runs', 'NAVIGATION/CORTEX/_generated', 'MEMORY/LLM_PACKER/_packs', 'CAPABILITY/PRIMITIVES/_scratch']

CAPABILITY\PIPELINES\pipeline_runtime.py:400: ValueError
_________________________ test_pipeline_chain_tamper __________________________

tmp_path = WindowsPath('C:/Users/rene_/AppData/Local/Temp/pytest-of-Reneshizzle/pytest-222/test_pipeline_chain_tamper0')

    def test_pipeline_chain_tamper(tmp_path: Path) -> None:
        pipeline_id = "pipeline-chain-tamper"
        spec_path, pipeline_dir = _setup_pipeline(Path("pipeline_chain_tamper"), pipeline_id=pipeline_id)
        rt = PipelineRuntime(project_root=REPO_ROOT)
        try:
>           rt.run(pipeline_id=pipeline_id, spec_path=spec_path)

CAPABILITY\TESTBENCH\test_pipeline_chain.py:127: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
CAPABILITY\PIPELINES\pipeline_runtime.py:204: in run
    self._execute_step(spec=spec, step=step, run_id=run_id)
CAPABILITY\PIPELINES\pipeline_runtime.py:404: in _execute_step
    jobspec = self._load_jobspec(step.jobspec_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <CAPABILITY.PIPELINES.pipeline_runtime.PipelineRuntime object at 0x000001BBDD277D50>
jobspec_path = 'pipeline_chain_tamper/jobspec_step1.json'

    def _load_jobspec(self, jobspec_path: str) -> Dict[str, Any]:
        rel = jobspec_path.replace("\\", "/")
        if Path(rel).is_absolute():
            raise ValueError("jobspec_path must be repo-relative")
        abs_path = self.project_root / rel
        obj = json.loads(abs_path.read_text(encoding="utf-8"))
        if not isinstance(obj, dict):
            raise ValueError("jobspec must be an object")
        preflight = PreflightValidator(self.jobspec_schema_path)
        valid, errors = preflight.validate(obj, self.project_root)
        if not valid:
            first = errors[0] if errors else {"code": "JOBSPEC_INVALID", "message": "invalid"}
>           raise ValueError(f"jobspec invalid: {first.get('code')}: {first.get('message')}")
E           ValueError: jobspec invalid: PATH_NOT_ALLOWED: Path pipeline_chain_tamper/domain in catalytic_domains not under allowed roots: ['LAW/CONTRACTS/_runs', 'NAVIGATION/CORTEX/_generated', 'MEMORY/LLM_PACKER/_packs', 'CAPABILITY/PRIMITIVES/_scratch']

CAPABILITY\PIPELINES\pipeline_runtime.py:400: ValueError
_________________________ test_pipeline_chain_reorder _________________________

tmp_path = WindowsPath('C:/Users/rene_/AppData/Local/Temp/pytest-of-Reneshizzle/pytest-222/test_pipeline_chain_reorder0')

    def test_pipeline_chain_reorder(tmp_path: Path) -> None:
        pipeline_id = "pipeline-chain-reorder"
        spec_path, pipeline_dir = _setup_pipeline(Path("pipeline_chain_reorder"), pipeline_id=pipeline_id)
        rt = PipelineRuntime(project_root=REPO_ROOT)
        try:
>           rt.run(pipeline_id=pipeline_id, spec_path=spec_path)

CAPABILITY\TESTBENCH\test_pipeline_chain.py:147: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
CAPABILITY\PIPELINES\pipeline_runtime.py:204: in run
    self._execute_step(spec=spec, step=step, run_id=run_id)
CAPABILITY\PIPELINES\pipeline_runtime.py:404: in _execute_step
    jobspec = self._load_jobspec(step.jobspec_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <CAPABILITY.PIPELINES.pipeline_runtime.PipelineRuntime object at 0x000001BBDD1A2C90>
jobspec_path = 'pipeline_chain_reorder/jobspec_step1.json'

    def _load_jobspec(self, jobspec_path: str) -> Dict[str, Any]:
        rel = jobspec_path.replace("\\", "/")
        if Path(rel).is_absolute():
            raise ValueError("jobspec_path must be repo-relative")
        abs_path = self.project_root / rel
        obj = json.loads(abs_path.read_text(encoding="utf-8"))
        if not isinstance(obj, dict):
            raise ValueError("jobspec must be an object")
        preflight = PreflightValidator(self.jobspec_schema_path)
        valid, errors = preflight.validate(obj, self.project_root)
        if not valid:
            first = errors[0] if errors else {"code": "JOBSPEC_INVALID", "message": "invalid"}
>           raise ValueError(f"jobspec invalid: {first.get('code')}: {first.get('message')}")
E           ValueError: jobspec invalid: PATH_NOT_ALLOWED: Path pipeline_chain_reorder/domain in catalytic_domains not under allowed roots: ['LAW/CONTRACTS/_runs', 'NAVIGATION/CORTEX/_generated', 'MEMORY/LLM_PACKER/_packs', 'CAPABILITY/PRIMITIVES/_scratch']

CAPABILITY\PIPELINES\pipeline_runtime.py:400: ValueError
_______________________ test_pipeline_chain_determinism _______________________

tmp_path = WindowsPath('C:/Users/rene_/AppData/Local/Temp/pytest-of-Reneshizzle/pytest-222/test_pipeline_chain_determinis0')

    def test_pipeline_chain_determinism(tmp_path: Path) -> None:
        pipeline_id = "pipeline-chain-determinism"
        tmp_root = Path("pipeline_chain_determinism")
        spec_path, pipeline_dir = _setup_pipeline(tmp_root, pipeline_id=pipeline_id)
        rt = PipelineRuntime(project_root=REPO_ROOT)
        try:
>           rt.run(pipeline_id=pipeline_id, spec_path=spec_path)

CAPABILITY\TESTBENCH\test_pipeline_chain.py:167: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
CAPABILITY\PIPELINES\pipeline_runtime.py:204: in run
    self._execute_step(spec=spec, step=step, run_id=run_id)
CAPABILITY\PIPELINES\pipeline_runtime.py:404: in _execute_step
    jobspec = self._load_jobspec(step.jobspec_path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <CAPABILITY.PIPELINES.pipeline_runtime.PipelineRuntime object at 0x000001BBDD34DA50>
jobspec_path = 'pipeline_chain_determinism/jobspec_step1.json'

    def _load_jobspec(self, jobspec_path: str) -> Dict[str, Any]:
        rel = jobspec_path.replace("\\", "/")
        if Path(rel).is_absolute():
            raise ValueError("jobspec_path must be repo-relative")
        abs_path = self.project_root / rel
        obj = json.loads(abs_path.read_text(encoding="utf-8"))
        if not isinstance(obj, dict):
            raise ValueError("jobspec must be an object")
        preflight = PreflightValidator(self.jobspec_schema_path)
        valid, errors = preflight.validate(obj, self.project_root)
        if not valid:
            first = errors[0] if errors else {"code": "JOBSPEC_INVALID", "message": "invalid"}
>           raise ValueError(f"jobspec invalid: {first.get('code')}: {first.get('message')}")
E           ValueError: jobspec invalid: PATH_NOT_ALLOWED: Path pipeline_chain_determinism/domain in catalytic_domains not under allowed roots: ['LAW/CONTRACTS/_runs', 'NAVIGATION/CORTEX/_generated', 'MEMORY/LLM_PACKER/_packs', 'CAPABILITY/PRIMITIVES/_scratch']

CAPABILITY\PIPELINES\pipeline_runtime.py:400: ValueError
=========================== short test summary info ===========================
FAILED CAPABILITY/TESTBENCH/test_pipeline_chain.py::test_pipeline_chain_valid - ValueError: jobspec invalid: PATH_NOT_ALLOWED: Path pipeline_chain_valid/domain in catalytic_domains not under allowed roots: ['LAW/CONTRACTS/_runs', 'NAVIGATION/CORTEX/_generated', 'MEMORY/LLM_PACKER/_packs', 'CAPABILITY/PRIMITIVES/_scratch']
FAILED CAPABILITY/TESTBENCH/test_pipeline_chain.py::test_pipeline_chain_tamper - ValueError: jobspec invalid: PATH_NOT_ALLOWED: Path pipeline_chain_tamper/domain in catalytic_domains not under allowed roots: ['LAW/CONTRACTS/_runs', 'NAVIGATION/CORTEX/_generated', 'MEMORY/LLM_PACKER/_packs', 'CAPABILITY/PRIMITIVES/_scratch']
FAILED CAPABILITY/TESTBENCH/test_pipeline_chain.py::test_pipeline_chain_reorder - ValueError: jobspec invalid: PATH_NOT_ALLOWED: Path pipeline_chain_reorder/domain in catalytic_domains not under allowed roots: ['LAW/CONTRACTS/_runs', 'NAVIGATION/CORTEX/_generated', 'MEMORY/LLM_PACKER/_packs', 'CAPABILITY/PRIMITIVES/_scratch']
FAILED CAPABILITY/TESTBENCH/test_pipeline_chain.py::test_pipeline_chain_determinism - ValueError: jobspec invalid: PATH_NOT_ALLOWED: Path pipeline_chain_determinism/domain in catalytic_domains not under allowed roots: ['LAW/CONTRACTS/_runs', 'NAVIGATION/CORTEX/_generated', 'MEMORY/LLM_PACKER/_packs', 'CAPABILITY/PRIMITIVES/_scratch']
============================== 4 failed in 0.29s ==============================
