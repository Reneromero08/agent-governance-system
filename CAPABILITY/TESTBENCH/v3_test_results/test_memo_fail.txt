============================= test session starts =============================
platform win32 -- Python 3.11.6, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\rene_\AppData\Local\Programs\Python\Python311\python.exe
cachedir: .pytest_cache
rootdir: D:\CCC 2.0\AI\agent-governance-system
configfile: pytest.ini
plugins: anyio-4.12.0
collecting ... collected 1 item

CAPABILITY/TESTBENCH/test_memoization.py::test_memoization_miss_then_hit_then_invalidate FAILED [100%]

================================== FAILURES ===================================
_______________ test_memoization_miss_then_hit_then_invalidate ________________

tmp_path = WindowsPath('C:/Users/rene_/AppData/Local/Temp/pytest-of-Reneshizzle/pytest-200/test_memoization_miss_then_hit0')

    def test_memoization_miss_then_hit_then_invalidate(tmp_path: Path) -> None:
        # Import runtime from CAPABILITY.TOOLS (repo-root module).
        import sys
        sys.path.insert(0, str(REPO_ROOT / "CAPABILITY" / "TOOLS" / "catalytic"))
        # sys.path cleanup
    
        from catalytic_runtime import CatalyticRuntime, PROJECT_ROOT  # type: ignore
        from CAPABILITY.PRIMITIVES.memo_cache import compute_job_cache_key  # type: ignore
    
        assert PROJECT_ROOT == REPO_ROOT
    
        run_id = "memoization-test-run"
        run_dir = REPO_ROOT / "LAW" / "CONTRACTS" / "_runs" / run_id
        cache_root = REPO_ROOT / "LAW" / "CONTRACTS" / "_runs" / "_cache" / "jobs"
    
        catalytic_domain = "CONTRACTS/_runs/_tmp/memoization-domain"
        durable_output = "CORTEX/_generated/memoization_output.txt"
        side_effect = "CONTRACTS/_runs/_tmp/memoization_side_effect.txt"
    
        # Clean any prior state.
        _rm(run_dir)
        _rm(cache_root)
        _rm(REPO_ROOT / durable_output)
        _rm(REPO_ROOT / side_effect)
    
        try:
            runtime1 = CatalyticRuntime(
                run_id=run_id,
                catalytic_domains=[catalytic_domain],
                durable_outputs=[durable_output],
                intent="memoization test",
                strict=True,
                memoize=True,
                validator_semver="0.1.0",
                validator_build_id="memo-test",
            )
    
            cmd_a = [
                sys.executable,
                "-c",
                (
                    "from pathlib import Path;"
                    f"Path('{durable_output}').write_text('A', encoding='utf-8');"
                    f"Path('{side_effect}').write_text('EXEC_A', encoding='utf-8')"
                ),
            ]
>           assert runtime1.run(cmd_a) == 0
E           assert 1 == 0
E            +  where 1 = run(['C:\\Users\\rene_\\AppData\\Local\\Programs\\Python\\Python311\\python.exe', '-c', "from pathlib import Path;Path('CORTEX/_generated/memoization_output.txt').write_text('A', encoding='utf-8');Path('CONTRACTS/_runs/_tmp/memoization_side_effect.txt').write_text('EXEC_A', encoding='utf-8')"])
E            +    where run = <catalytic_runtime.CatalyticRuntime object at 0x000001B204C77C10>.run

CAPABILITY\TESTBENCH\test_memoization.py:69: AssertionError
---------------------------- Captured stdout call -----------------------------
[catalytic] Starting catalytic run: memoization-test-run
[catalytic] Phase 0: Preflight validation...
---------------------------- Captured stderr call -----------------------------
[catalytic] PREFLIGHT REJECTION: JobSpec violates contract
  [PATH_NOT_ALLOWED] Path CONTRACTS\_runs\_tmp\memoization-domain in catalytic_domains not under allowed roots: ['LAW/CONTRACTS/_runs', 'NAVIGATION/CORTEX/_generated', 'MEMORY/LLM_PACKER/_packs', 'CAPABILITY/PRIMITIVES/_scratch']
  [PATH_NOT_ALLOWED] Path CORTEX\_generated\memoization_output.txt in outputs.durable_paths not under allowed roots: ['LAW/CONTRACTS/_runs', 'NAVIGATION/CORTEX/_generated', 'MEMORY/LLM_PACKER/_packs', 'CAPABILITY/PRIMITIVES/_scratch']
[catalytic] ERROR writing canonical artifacts: [WRITE_GUARD] WRITE_GUARD_PATH_NOT_ALLOWED: Write path D:\CCC 2.0\AI\agent-governance-system\CONTRACTS\_runs\memoization-test-run\JOBSPEC.json not under allowed roots: ['LAW/CONTRACTS/_runs', 'NAVIGATION/CORTEX/_generated', 'MEMORY/LLM_PACKER/_packs', 'CAPABILITY/PRIMITIVES/_scratch']
============================== warnings summary ===============================
CAPABILITY/TESTBENCH/test_memoization.py::test_memoization_miss_then_hit_then_invalidate
CAPABILITY/TESTBENCH/test_memoization.py::test_memoization_miss_then_hit_then_invalidate
  D:\CCC 2.0\AI\agent-governance-system\CAPABILITY\PRIMITIVES\ledger.py:9: DeprecationWarning: jsonschema.RefResolver is deprecated as of v4.18.0, in favor of the https://github.com/python-jsonschema/referencing library, which provides more compliant referencing behavior as well as more flexible APIs for customization. A future release will remove RefResolver. Please file a feature request (on referencing) if you are missing an API for the kind of customization you need.
    from jsonschema import Draft7Validator, RefResolver

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED CAPABILITY/TESTBENCH/test_memoization.py::test_memoization_miss_then_hit_then_invalidate - assert 1 == 0
 +  where 1 = run(['C:\\Users\\rene_\\AppData\\Local\\Programs\\Python\\Python311\\python.exe', '-c', "from pathlib import Path;Path('CORTEX/_generated/memoization_output.txt').write_text('A', encoding='utf-8');Path('CONTRACTS/_runs/_tmp/memoization_side_effect.txt').write_text('EXEC_A', encoding='utf-8')"])
 +    where run = <catalytic_runtime.CatalyticRuntime object at 0x000001B204C77C10>.run
======================== 1 failed, 2 warnings in 0.21s ========================
