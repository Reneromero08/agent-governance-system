import os
import subprocess
import pytest
from pathlib import Path

def get_repo_root() -> Path:
    """Get the repository root path using common patterns."""
    # Try common patterns to find repo root
    current_path = Path.cwd()
    for candidate in ['.git', 'pyproject.toml', 'setup.py']:
        if (current_path / candidate).exists():
            return current_path
        current_path = current_path.parent
    raise RuntimeError("Could not determine repository root")

# Use the function to get repo root
REPO_ROOT = get_repo_root()

def test_ags_phase6_bridge():
    # Example usage of REPO_ROOT
    repo_path = Path(REPO_ROOT)

    # Safer alternative to subprocess.call using subprocess.run()
    try:
        result = subprocess.run(
            ["ls", "-l"],
            check=True,
            capture_output=True,
            text=True
        )
        assert result.returncode == 0, f"Command failed with error: {result.stderr}"
    except subprocess.CalledProcessError as e:
        assert False, f"Command failed with error: {e.stderr}"

# Fix the import error by defining REPO_ROOT before using it in the test function
REPO_ROOT = get_repo_root()