## HEADER
phase: 1
task_id: 1.4
slug: failure-taxonomy-recovery-playbooks-ops-grade
legacy_id: P01_1-4
policy_canon_sha256: b12a0779118b646c99b02662c4b487f136dd74c1053fd7090095fc45ced99882
guide_canon_sha256: e4f1d187828771c337b5394cbba6ed5e96b0bd7be66b7db3aacedaf2072def5c
depends_on: []
primary_model: GPT-5.2-Codex (Reasoning: Low)
fallback_chain:
  - Claude Sonnet (Reasoning: High)
  - Gemini Pro (Reasoning: High)
receipt_path: LAW/CONTRACTS/_runs/_tmp/prompts/1.4_failure-taxonomy-recovery-playbooks-ops-grade/receipt.json
report_path: LAW/CONTRACTS/_runs/_tmp/prompts/1.4_failure-taxonomy-recovery-playbooks-ops-grade/REPORT.md
max_report_lines: 600

## ROLE + MODEL
- You are an AGS executor operating inside this repo.
- You must follow repo LAW/CANON precedence and contracts.
- You must follow PROMPTS/PROMPT_POLICY_CANON.md and PROMPTS/PROMPT_GENERATOR_GUIDE_FINAL.md.
- Primary model: GPT-5.2-Codex (Reasoning: Low)
- Fallback chain: use only if required to reach DONE = GREEN.

## GOAL
Execute task **1.4** (failure-taxonomy-recovery-playbooks-ops-grade) exactly as specified, without scope drift.

Source prompt body (carried forward, normalized):

---
Model: GPT-5.2-Codex
Thinking: Low

```text
ROLE + MODEL
- Primary: GPT-5.2-Codex (Thinking: Low)
- Fallback chain: Claude Sonnet 4.5 (non-thinking) -> Gemini 3 Pro (Low) -> Qwen2.5-Coder 7B (local)

GOAL
Implement **1.4 Failure Taxonomy & Recovery Playbooks (ops-grade)** by completing its unchecked checklist items from the roadmap. Do not start adjacent sections or “helpful extras”.

SCOPE LOCK
- This prompt implements ONLY this roadmap section.
- Hard rule: no refactors that are not required by the section’s checklist.
- If a checklist item cannot be satisfied without expanding scope, FAIL-CLOSED: emit receipt+report with verdict=FAIL and stop without broadening scope.

SCOPE (WRITE ALLOWLIST)
- Allowed writes (minimal and necessary only):
  - NAVIGATION/OPS/FAILURE_CATALOG.md
  - NAVIGATION/OPS/SMOKE_RECOVERY.md
  - LAW/CONTRACTS/_runs/_tmp/prompts/1-4-failure-taxonomy-recovery-playbooks-ops-grade/  (receipts + report only)
- Allowed deletes/renames:
  - None by default. If absolutely required, justify in REPORT and keep within allowlist.
- Forbidden (absolute):
  - Any writes under `LAW/CANON/`, `.git/`, `BUILD/`, and any other governance roots not directly required.
  - Any “cleanup sweep” unrelated to the checklist.

REQUIRED FACTS (DERIVE, DON’T Guess)
- Repo sanity:
  - `git rev-parse --show-toplevel`
  - `git status --porcelain`
- Extract the exact checklist items for THIS section (source of truth):
  - python - `.

ARTIFACTS (RECEIPTS + REPORT)
- Receipt:
  - Path: LAW/CONTRACTS/_runs/_tmp/prompts/1-4-failure-taxonomy-recovery-playbooks-ops-grade/receipt.json
  - JSON, deterministic: sorted keys, stable ordering for lists.
  - Include:
    - section_title, section_slug, timestamp_utc
    - git: HEAD before, HEAD after, branch
    - changed_files: ordered list (from `git diff --name-only`)
    - commands_run: ordered list with exit codes
    - tests_run: ordered list with exit codes
    - verdict: PASS/FAIL
    - errors: ordered list
- Report:
  - Path: LAW/CONTRACTS/_runs/_tmp/prompts/1-4-failure-taxonomy-recovery-playbooks-ops-grade/REPORT.md
  - Must include:
    - Checklist coverage (each item with evidence)
    - What changed (file list)
    - Proofs (tests/commands + results)
    - Any deviations (should be none) and why
    - Next recommended section ID (if PASS)

EXIT CRITERIA
- [ ] [GLOBAL] All relevant tests pass (task is incomplete until green).
- [ ] [GLOBAL] Receipts emitted (inputs, outputs, hashes, commands run, exit status).
- [ ] [GLOBAL] Human-readable report emitted (what changed, why, how verified, how to reproduce).
- [ ] [GLOBAL] Scope respected (explicit allowlist for writes; deletions/renames only if explicitly scoped).
- [ ] 1.4.1 Create `NAVIGATION/OPS/FAILURE_CATALOG.md` listing expected fail-closed errors by subsystem (CAS, ARTIFACTS, RUNS, GC, AUDIT, SKILL_RUNTIME, PACKER)
- [ ] 1.4.2 Add a deterministic “Recovery” appendix to each major invariant doc:
- [ ] 1.4.3 Add `NAVIGATION/OPS/SMOKE_RECOVERY.md` with the top 10 recovery flows as copy/paste commands (Windows + WSL where relevant)
- [ ] A new contributor can identify and recover from common failures without tribal knowledge
- [ ] Recovery steps are deterministic and reference exact commands and artifacts

```
---

## SCOPE (WRITE ALLOWLIST)
- Allowed writes: only files required by this task; you must enumerate the exact file paths in your report *before* editing them.
- Allowed deletes/renames: only within the same allowlist, and only if necessary to satisfy the task.
- Forbidden writes: everything else.

## REQUIRED FACTS (VERIFY, DO NOT GUESS)
- UNKNOWN_BLOCKER: if a required fact cannot be verified, stop the task with result = BLOCKED_UNKNOWN.
- UNKNOWN_DEFERRABLE: only allowed as `FILL_ME__<KEY>` tokens inside this section.

Preflight token policy:
- Executor scans for `FILL_ME__` tokens.
- If any token is unresolved, stop with result = BLOCKED_UNKNOWN.
- If tokens are resolved, the values must satisfy the same Verify via checks.

Required repo reality checks:
- Verify repo root and target paths exist (ls, stat).
- Verify any referenced scripts or commands exist before invoking.

## PLAN (EXPLICIT STEPS)
1) Preflight: enumerate intended edits and confirm they are within SCOPE allowlist.
2) Implement: perform the task steps from the Source prompt body above.
3) Record: capture commands run and outputs in the report.
4) Validate: run required checks and tests until DONE = GREEN.
5) Write artifacts: receipt JSON and report at the declared paths.

## VALIDATION (DONE = GREEN)
- Run the task-specific verification steps described in the Source prompt body.
- If `scripts/lint-prompt.sh` exists, run it when touching prompt-pack content and apply exit-code rules:
  - exit 1 blocks and stops
  - exit 2 is a warning (record it and continue)
- DONE = GREEN only when all validations pass and scope remained bounded.

## ARTIFACTS (RECEIPT + REPORT)
- receipt_path: LAW/CONTRACTS/_runs/_tmp/prompts/1.4_failure-taxonomy-recovery-playbooks-ops-grade/receipt.json
- report_path: LAW/CONTRACTS/_runs/_tmp/prompts/1.4_failure-taxonomy-recovery-playbooks-ops-grade/REPORT.md

Receipt JSON required fields:
- task_id, timestamp_utc, primary_model, fallback_chain, policy_canon_sha256, guide_canon_sha256,
  depends_on, receipt_path, report_path, allowed_writes, allowed_deletes_renames,
  unknowns_or_missing_inputs, commands_run, validations, inputs, outputs, result

Result enum: OK | VERIFICATION_FAILED | BLOCKED_UNKNOWN | INTERNAL_ERROR

## EXIT CRITERIA
- [ ] Task completed per Source prompt body
- [ ] All validations pass (DONE = GREEN)
- [ ] Receipt + report written to declared paths
- [ ] No scope drift (only allowlisted files touched)

