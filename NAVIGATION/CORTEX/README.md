<!-- CONTENT_HASH: updated -->

# Cortex

The cortex is a semantic search and navigation layer for the repository. It enables agents and skills to query metadata about files, pages, and sections without scanning the filesystem or loading full documents into context.

## Architecture

The cortex uses a **cassette network** - modular SQLite databases with FTS5 full-text search and vector embeddings:

### Cassettes (`NAVIGATION/CORTEX/cassettes/`)

| Cassette | Description | Mutability |
|----------|-------------|------------|
| `canon.db` | Constitutional documents (LAW/) | immutable |
| `governance.db` | Decisions and preferences (CONTEXT/) | stable |
| `capability.db` | Code, skills, primitives (CAPABILITY/) | mutable |
| `navigation.db` | Maps, cortex metadata (NAVIGATION/) | mutable |
| `direction.db` | Roadmaps, strategy (DIRECTION/) | mutable |
| `thought.db` | Research, lab, demos (THOUGHT/) | mutable |
| `memory.db` | Archive, reports (MEMORY/) | append_only |
| `inbox.db` | Staging, temporary (INBOX/) | ephemeral |
| `resident.db` | Per-agent AI memories | read_write |

### Key Components

- `network/cassettes.json` - Configuration for all cassettes
- `network/generic_cassette.py` - Base cassette class with FTS5 + navigation
- `network/memory_cassette.py` - Write-capable cassette for AI memories
- `network/network_hub.py` - Multi-cassette query coordinator
- `semantic/` - Embedding and semantic search utilities
- `meta/` - Generated indexes (FILE_INDEX.json, SECTION_INDEX.json)
- `db/provenance.db` - Audit ledger for provenance tracking

### Query Interface

Use the MCP tool `cassette_network_query` for semantic search:

```json
{
  "tool": "cassette_network_query",
  "args": {
    "query": "invariants",
    "limit": 10,
    "cassettes": ["canon", "governance"]
  }
}
```

### Navigation

The cassette network supports hierarchical navigation through markdown structure:

- `get_chunk(id)` - Get a specific chunk
- `get_parent(id)` - Navigate up the hierarchy
- `get_children(id)` - Get direct children
- `get_siblings(id)` - Get prev/next at same depth
- `get_path(id)` - Breadcrumb trail to root

This hierarchical navigation enables "System 2" slow thinking - drilling down into detail through `# ## ### ####` heading levels.

## Generated Files

The `meta/` directory contains generated indexes:

- `FILE_INDEX.json` - File metadata and section listings
- `SECTION_INDEX.json` - Section-level index with hashes

These are regenerated by `semantic/indexer.py`.

## History

The cortex evolved through several phases:

1. **v1.0** - Monolithic `system1.db` (deprecated, removed)
2. **v2.0** - `_generated/cortex.db` with section indexes (deprecated, removed)
3. **v3.0** - Cassette network with bucket-aligned partitions

The current architecture prioritizes:
- Modular, semantic-aligned data partitions
- Structure-aware chunking (markdown headers)
- Hierarchical navigation for deep exploration
- Content-addressed verification (Merkle roots)
