---
title: "F3_STRATEGY"
section: "research"
author: "System"
priority: "Medium"
created: "2025-12-29 07:01"
modified: "2025-12-29 07:01"
status: "Active"
summary: "Legacy research document migrated to canon format"
tags: ["research", "legacy"]
---
<!-- CONTENT_HASH: 1a93ab6f77744ebfe64f16e06f7873066cc0164a6bf9ce0a06dccb7f9d1dc51b -->

# F3 Strategy: Catalytic Context Compression

**Status**: Prototype
**Date**: 2025-12-28
**Lane**: F3 (AGS Roadmap)

## Goal
Reduce the token cost of LITE packs by replacing file bodies with SHA-256 pointers, while guaranteeing that a FULL pack (or the original repo state) can be reconstructed deterministically from those pointers.

## 1. Content-Addressed Storage (CAS) Strategy

We utilize a **CAS** where files are stored by their content hash rather than their path.

### Storage Layout
Artifacts are stored in a flat structure under a designated root (e.g., `CONTRACTS/_runs/_cache/cas/` for the prototype).

```text
cas/
  a5/
    a5b2c3d4... (blob)
  f1/
    f1e2d3c4... (blob)
```

### Invariants
1.  **Immutable**: Once written, a blob never changes.
2.  **Deterministic**: The hash is calculated from the raw bytes of the file (SHA-256).
3.  **Deduplicated**: Identical files share the same storage, regardless of filename.

## 2. The Manifest (Pointer Map)

The "LITE" representation of a directory is a JSON manifest mapping normalized paths to hashes.

```json
{
  "src/main.py": "a5b2c3d4...",
  "README.md": "f1e2d3c4..."
}
```

## 3. Retrieval Instructions (Hydration)

To reconstruct (hydrate) the state:

1.  **Read Manifest**: Load the JSON map.
2.  **Verify CAS**: Ensure all referenced hashes exist in the CAS.
3.  **Materialize**:
    *   For each `path` -> `hash`:
    *   Copy `cas/{hash}` to `{target_dir}/{path}`.
    *   (Optional) Verify hash of restored file.

## 4. Integration with LLM Packer

Future integration into `MEMORY/LLM_PACKER`:
1.  **Packer LITE**: Scans repo, writes blobs to CAS, emits `manifest.json` into the pack instead of file bodies.
2.  **Agent Hydrator**: Reads `manifest.json`, restores files to a working directory (or `CONTRACTS/_runs/_worktree`) if deep inspection is needed.

## 5. Proof of Concept

See `CATALYTIC-DPT/LAB/PROTOTYPES/f3_cas_prototype.py`. This script:
1.  Generates random test data.
2.  Ingests it into a CAS.
3.  Wipes the data.
4.  Restores it from CAS + Manifest.
5.  Verifies bit-perfect restoration.